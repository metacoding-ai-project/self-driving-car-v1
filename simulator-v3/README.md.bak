# Simulator v3 - 최종 버전 (완전한 일반화)

## 📋 프로젝트 설명

이 버전은 **모든 문제가 해결된 최종 버전**입니다.
여러 맵에서 학습하고, 랜덤 시작점/목적지를 사용하여 완전한 일반화를 달성했습니다.

## ✨ 주요 특징

### 1. 여러 맵에서 학습 ✅
- **20개 이상의 다양한 맵**: 단순, 중간, 복잡, 랜덤 맵
- **매 에피소드마다 다른 맵**: 일반화된 패턴 학습
- **랜덤 맵 생성**: 완전히 새로운 맵도 처리 가능

### 2. 랜덤 시작점/목적지 ✅
- **매 에피소드마다 다른 위치**: 다양한 상황 학습
- **랜덤 초기 방향**: 모든 방향 탐험
- **일반화된 경로 찾기**: 어떤 위치에서도 작동

### 3. 모든 v2 개선사항 포함 ✅
- 랜덤 초기 방향
- 느린 Epsilon Decay (0.998)
- Gradient Clipping
- 경로 다양성 보상
- 방문한 위치 추적

### 4. 개선된 하이퍼파라미터 ✅
- 에피소드 수: 3,000 (v1: 500)
- 배치 크기: 64 (v1: 32)
- 학습률: 0.0005 (v1: 0.001)
- 메모리 용량: 20,000 (v1: 10,000)

## 🎯 해결된 문제점

### ✅ v1의 모든 문제 해결
- 한쪽으로만 이동하는 문제 → 해결
- 특정 경로에 고착화 → 해결
- 단일 맵 학습 → 해결
- 학습 불안정성 → 해결

### ✅ v2의 한계점 해결
- 단일 맵 학습 → 여러 맵 학습
- 고정된 시작점/목적지 → 랜덤 시작점/목적지
- 일반화 제한 → 완전한 일반화

## 📊 예상되는 학습 결과

### Episode 0-500: 초보 단계 🔴
- 여러 맵에서 랜덤하게 움직임
- 벽에 자주 부딪힘
- 평균 3-5스텝 생존
- 성공률: 10-20%

### Episode 500-1500: 학습 시작 🟡
- 다양한 맵에서 패턴 발견
- 벽을 피하기 시작
- 10-50스텝 생존
- 성공률: 30-50%
- **다양한 맵에서 작동**

### Episode 1500-3000: 마스터! ✅
- 모든 맵에서 벽을 거의 안 부딪힘
- 100-500스텝 생존
- 성공률: 60-80%
- **새로운 맵에서도 작동**
- **랜덤 시작점/목적지에서도 작동**

## 🚀 사용 방법

### 1. 패키지 설치

```bash
python -m pip install pygame-ce numpy torch matplotlib
```

### 2. 훈련 시작

```bash
cd simulator-v3
python train.py
```

**특징:**
- 여러 맵에서 자동으로 학습
- 맵별 성공률 추적
- 성공률 그래프 자동 생성

### 3. 테스트

```bash
python main.py
```

**특징:**
- 랜덤 맵으로 테스트
- R키: 새로운 랜덤 맵으로 리셋
- 일반화 성능 확인

## 📈 학습 결과

훈련이 완료되면:
- `model_final.pth`: 최종 모델
- `training_results.png`: 학습 그래프
  - 보상 그래프
  - 에피소드 길이 그래프
  - 맵별 성공률
  - 성공률 추이

## 🔄 버전 비교

| 항목 | v1 | v2 | v3 |
|------|----|----|----|
| 초기 방향 | 고정 | 랜덤 | 랜덤 |
| Epsilon decay | 0.995 | 0.998 | 0.998 |
| Gradient clipping | 없음 | 있음 | 있음 |
| 경로 다양성 보상 | 없음 | 있음 | 있음 |
| 맵 개수 | 1개 | 1개 | 20개 이상 |
| 시작점/목적지 | 고정 | 고정 | 랜덤 |
| 일반화 | 불가능 | 제한적 | 완전 |
| 실제 적용 | 어려움 | 어려움 | 가능 |

---

## 🧪 테스트셋과 훈련셋 분리의 중요성

### 🤔 왜 테스트셋과 훈련셋이 달라야 할까요?

**핵심 문제: 과적합(Overfitting) 검증**

모델이 **훈련에 사용한 맵에서만 잘 작동**하고, **새로운 맵에서는 실패**한다면, 이는 **과적합**입니다.

### 📊 훈련셋 vs 테스트셋

#### 훈련셋 (Training Set)
- **목적**: 모델을 학습시키는 데 사용
- **v3에서**: 0-19번 맵 (20개 맵)
- **역할**: 다양한 패턴을 학습하도록 도와줌

#### 테스트셋 (Test Set)
- **목적**: 모델의 일반화 능력을 검증
- **v3에서**: 20번 이상의 새로운 맵 또는 완전히 새로운 랜덤 맵
- **역할**: 모델이 **보지 못한 새로운 상황**에서도 작동하는지 확인

### ❌ 테스트셋을 훈련셋과 같게 하면?

```
훈련: 맵 0-19에서 학습
테스트: 맵 0-19에서 테스트

문제:
- 모델이 이미 본 맵에서만 테스트됨
- 과적합 여부를 확인할 수 없음
- 실제 성능을 정확히 평가할 수 없음
```

**비유:** 시험 문제를 미리 외워서 시험을 보는 것과 같습니다. 진짜 실력을 알 수 없습니다!

### ✅ 테스트셋을 훈련셋과 다르게 하면?

```
훈련: 맵 0-19에서 학습
테스트: 맵 20+ 또는 완전히 새로운 랜덤 맵에서 테스트

장점:
- 모델의 일반화 능력을 정확히 평가
- 과적합 여부를 확인 가능
- 실제 성능을 알 수 있음
- 새로운 상황에서도 작동하는지 검증
```

**비유:** 새로운 문제로 시험을 보는 것과 같습니다. 진짜 실력을 알 수 있습니다!

### 🎯 v3의 해결 방법

#### 훈련 단계 (`train.py`)
```python
# 훈련 맵: 0-19번 맵만 사용
current_map_id = random.randint(0, NUM_MAPS - 1)  # 0-19
env.reset_map(current_map_id)
```

#### 테스트 단계 (`main.py`)
```python
# 테스트 맵: 훈련에 사용하지 않은 새로운 맵 사용
# 방법 1: 완전히 새로운 랜덤 맵
env = GridEnvironment(random_map=True)

# 방법 2: 훈련 범위를 벗어난 맵 ID (20+)
# (구현 가능)
```

### 💡 핵심 정리

1. **훈련셋**: 모델을 학습시키는 데 사용 (0-19번 맵)
2. **테스트셋**: 모델의 일반화 능력을 검증 (새로운 맵)
3. **분리 이유**: 과적합 여부를 확인하고 실제 성능을 평가하기 위해
4. **v3의 장점**: 테스트 시 새로운 맵에서 실행하여 일반화 능력을 검증

**비유:**
- **훈련셋 = 연습 문제**: 여러 문제를 풀어보며 패턴을 학습
- **테스트셋 = 시험 문제**: 새로운 문제로 실력을 검증

---

## ⚙️ 설정 변경

`config.py` 파일에서 설정을 변경할 수 있습니다:

```python
# 에피소드 수
NUM_EPISODES = 3000  # 더 많이 학습하려면 증가

# 맵 개수
NUM_MAPS = 20  # 더 많은 맵으로 학습하려면 증가

# 속도
CURRENT_SPEED = SPEED_NORMAL  # SPEED_FAST로 변경하면 빠르게
```

## 💡 팁

1. **빠른 학습**: `SHOW_TRAINING = False` 설정
2. **더 많은 맵**: `NUM_MAPS = 30` 또는 50으로 증가
3. **더 긴 학습**: `NUM_EPISODES = 5000` 또는 10000

## 📚 학습 내용

이 버전을 통해 다음을 학습할 수 있습니다:

- 완전한 일반화 달성
- 여러 맵에서의 학습 방법
- 랜덤 시작점/목적지 처리
- 과적합 완전 해결
- 실제 환경 적용 방법

## 🎓 다음 단계

이 버전으로 학습한 모델은:

1. **새로운 맵에서도 작동**
2. **실제 환경에 적용 가능**
3. **다양한 시작점/목적지에서 작동**

---

## 🔮 다음 단계 개선 사항

이 버전의 개선 가능한 사항들:

### ✅ v4에서 해결될 사항
- **Learning Rate Scheduling**: 동적 학습률 조정으로 학습 속도 향상
- **빠른 초기 탐색**: 큰 보폭으로 빠른 탐색
- **정밀한 후기 학습**: 작은 보폭으로 정밀 조정

### 📋 현재 알려진 한계점
1. **고정된 학습률**: 학습 속도가 느릴 수 있음
2. **초기 탐색 속도**: 고정된 학습률로 인한 느린 초기 탐색
3. **최적점 근처 정밀 조정**: 고정된 학습률로 인한 제한

**다음 버전**: [`simulator-v4/README.md`](../simulator-v4/README.md)에서 학습 속도 향상 버전 확인

---

**✅ 최종 버전**: 모든 문제가 해결된 완전한 일반화 버전입니다!
